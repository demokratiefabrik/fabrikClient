(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{1640:function(e,i,t){"use strict";t.r(i);var a=function(){var e=this,i=e.$createElement,t=e._self._c||i;return e.oauth.payload?t("div",{staticClass:"doc_content "},[t("h1",[e._v("Sekretariat")]),t("div",[t("div",[t("div",{staticClass:"q-gutter-y-md column",staticStyle:{"max-width":"600px"}},[t("p",[t("b",[e._v("Peudonym: ")]),e._v("\n          Sie bekommen auf dieser Plattform einen eigenen Namen. Andere Teilnehmende werden Sie unter diesem Namen ansprechen können. "+e._s(e.username_derivation)+". "),t("br"),t("br"),t("q-input",{attrs:{disable:"",outlined:"",dense:!0},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"mdi-account"}})]},proxy:!0}],null,!1,3128686816),model:{value:e.profile.pseudonym,callback:function(i){e.$set(e.profile,"pseudonym",i)},expression:"profile.pseudonym"}})],1),e.loading?e._e():t("p",[t("b",[e._v("Kontaktangabe: ")]),e._v("\n          "+e._s(this.profile.original_email?"Sie können hier Ihre Kontaktdaten ändern:":"Bitte geben Sie Ihre Emailadresse ein:")+"\n\n          "),t("q-input",{staticClass:"q-ma-sm",attrs:{"bg-color":e.isValidContact?"lime":"yellow",outlined:"",dense:!0},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:e.isPhone?"mdi-phone":"mdi-email"}})]},proxy:!0}],null,!1,3046994527),model:{value:e.profile.email,callback:function(i){e.$set(e.profile,"email",i)},expression:"profile.email"}}),t("small",[e._v(e._s(e.$t("auth.profile_email_hint")))])],1)])]),t("br"),t("br"),t("q-btn",{staticClass:"q-ma-xs",attrs:{loading:e.loading,color:"primary",label:e.$t("auth.profile_update_action"),disabled:!e.isEnabledSubmitButton},on:{click:e.saveProfile},scopedSlots:e._u([{key:"loading",fn:function(){return[t("q-spinner-facebook")]},proxy:!0}],null,!1,4102112682)}),this.profile.original_email?t("q-btn",{attrs:{color:"primary",disabled:!e.profile.original_email,outline:"",label:e.$t("app.btn_close")},on:{click:e.skipProfile}}):e._e(),t("br"),t("br"),t("br"),t("br"),t("AlgorithmDisclaimer",{attrs:{expanded:!0,text:e.$t("auth.profile_email_disclaimer")}})],1),t("q-dialog",{attrs:{persistent:""},model:{value:e.confirmation,callback:function(i){e.confirmation=i},expression:"confirmation"}},[t("q-card",{staticStyle:{"min-width":"350px"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v("Die Kontaktangabe wurde gespeichert")]),t("p",[e._v("\n          Überprüfen Sie bitte ein letztes Mal ob die folgende Kontaktangabe korrekt ist:\n        ")])]),t("q-card-section",{staticClass:"q-pt-none q-ml-xl q-mr-xl"},[t("q-input",{attrs:{dense:"","input-style":"font-size:1.5em",readonly:"",autofocus:""},on:{keyup:function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter"))return null;e.prompt=!1}},model:{value:e.profile.email,callback:function(i){e.$set(e.profile,"email",i)},expression:"profile.email"}})],1),t("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Nein, ich möchte Sie ändern"}}),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:this.isValidEmail?"Ja, die Emailadresse ist korrekt":"Ja, die Handy-Nummer ist korrekt"},on:{click:e.confirm}})],1)],1)],1)],1):e._e()},n=[],o=(t("99af"),t("caad"),t("ac1f"),t("2532"),t("1276"),t("ded3")),l=t.n(o),r=(t("2105"),t("7c15")),s=t("2f62"),c=t("9345"),p=(t("c75e"),{name:"Profile",components:{AlgorithmDisclaimer:c["a"]},props:{destination_route:Object},data:function(){return{confirmation:!1,profile:{pseudonym:"",email:"",original_email:""},error:!1,errormsg:"",loading:!0,action:null,btnlabel:"",payload:this.oauth.payload}},computed:l()(l()({username_derivation:function(){if(!this.public_profile)return"";var e=this.public_profile.ALT,i=this.public_profile.FN,t=this.public_profile.CA;return this.$i18n.t("auth.name_derivation",{fullname:i,canton:t,altitude:e})}},Object(s["c"])({public_profile:"publicprofilestore/get_public_profile"})),{},{isEnabledSubmitButton:function(){var e=this.profile.original_email!=this.profile.email;return e&&this.isValidContact&&!this.loading},isValidContact:function(){return this.isPhone?this.isValidPhone:this.isValidEmail},isPhone:function(){var e=/^[^a-zA-Z]+$/;return this.profile.email&&e.test(this.profile.email)},isValidEmail:function(){var e=/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/;return e.test(this.profile.email)},isValidPhone:function(){var e=/(\b(0041|0)|\B\+41)(\s?\(0\))?(\s)?([1-9]{2}|77[1-9]{1})(\s)?[0-9]{3}(\s)?[0-9]{2}(\s)?[0-9]{2}\b/;return e.test(this.profile.email)},completedEmailOrSMS:function(){return this.isValidEmail?this.profile.email:this.isValidPhone?"".concat(this.profile.email,"@").concat("sms.unibe.ch"):void 0}}),methods:{emailToSms:function(e){return e&&e.includes("sms.unibe.ch")?e.split("@")[0]:e},skipProfile:function(){var e=this.destination_route?this.destination_route:{name:"home"};this.$router.push(e)},saveProfile:function(){var e=this;this.loading=!0,console.log("Save profile !!!"),console.log(this.profile),r["a"].authProfile({email:this.completedEmailOrSMS}).then((function(i){i.data.ok?(e.$i18n.t("auth.profile_update_success"),e.oauth.payload.userEmail=!0,e.profile.original_email=e.profile.email):e.$i18n.t("auth.profile_update_error"),e.confirmation=!0,e.loading=!1}))},confirm:function(){var e=this.destination_route?this.destination_route:{name:"home"};this.$router.push(e)}},mounted:function(){var e=this;this.oauth.payload||this.$router.push({name:"home"}),this.profile.pseudonym=this.public_profile.U,r["a"].authProfile({}).then((function(i){if(i.data)e.profile.email=e.emailToSms(i.data.email),e.profile.original_email=e.emailToSms(i.data.email);else{var t=e.$i18n.t("auth.profile_load_error");e.$q.notify({type:"nFabrikError",message:t})}e.loading=!1})).catch((function(i){console.log(i),e.loading=!1}))}}),u=p,d=t("2877"),m=t("27f9"),f=t("0016"),h=t("9c40"),b=t("e669"),_=t("24e8"),v=t("f09f"),g=t("a370"),k=t("4b7e"),y=t("7f67"),S=t("eebe"),q=t.n(S),x=Object(d["a"])(u,a,n,!1,null,null,null);i["default"]=x.exports;q()(x,"components",{QInput:m["a"],QIcon:f["a"],QBtn:h["a"],QSpinnerFacebook:b["a"],QDialog:_["a"],QCard:v["a"],QCardSection:g["a"],QCardActions:k["a"]}),q()(x,"directives",{ClosePopup:y["a"]})}}]);