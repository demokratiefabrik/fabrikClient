(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{"5b45":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=this,n=t.$createElement,i=t._self._c||n;return i("q-popup-edit",{ref:"popup_content_formor",attrs:{cover:!0,"max-height":"100%",anchor:"center middle",self:"center middle",persistent:"",validate:t.validate},on:{save:t.saveContent},model:{value:t.localmodel,callback:function(e){t.localmodel=e},expression:"localmodel"}},[t.CONTENTTREE.limitForAddingCommentsReached&&!t.isAModification?i("div",{staticClass:"q-mb-md q-ml-md text-notification"},[t._v("\n\n    Sie haben heute schon "+t._s(t.dailyContributionLimits.current)+" Kommentare geschrieben. Damit haben Sie die Tageslimite erreicht.\n    Ab morgen früh können Sie wieder neue Kommentare verfassen.\n\n    "),i("q-btn",{attrs:{flat:"",label:"Abbrechen",dense:"",size:"md",icon:"mdi-close"},on:{click:function(e){return e.stopPropagation(),t.$refs["popup_content_formor"].cancel()}}})],1):t._e(),!t.$loaded(t.localmodel)||t.CONTENTTREE.limitForAddingCommentsReached&&!t.isAModification?t._e():i("div",{staticClass:"q-pa-md"},[i("div",{staticStyle:{float:"right"}},[i("q-btn",{attrs:{flat:"",label:"Abbrechen",dense:"",size:"md",icon:"mdi-close"},on:{click:function(e){return e.stopPropagation(),t.$refs["popup_content_formor"].cancel()}}}),i("q-btn",{attrs:{flat:"",label:t.submitButtonLabel,dense:"",size:"md",icon:"mdi-check"},on:{click:function(e){return e.stopPropagation(),t.$refs["popup_content_formor"].set()}}})],1),i("div",{staticClass:"full-width q-gutter-y-md column",staticStyle:{"max-width":"600px"}},[t.isAModification?i("div",[t.reviewNeeded?i("p",[t._v(" Sie können einen Änderungsvorschlag einreichen. Andere zufällig ausgewählte TeilnehmerInnen werden danach darüber befinden.")]):t._e(),t.reviewNeeded?t._e():i("p",[t._v(" Sie können diesen Inhalt direkt bearbeiten oder löschen.")])]):t._e(),t.isAModification?t._e():i("div",[t.reviewNeeded?i("p",[t._v(" Sie können hier einen neuen Beitrag vorschlagen. Andere zufällig ausgewählte TeilnehmerInnen werden danach darüber befinden.")]):t._e(),t.reviewNeeded?t._e():i("div",[t.parentReference?i("p",[t._v("\n            Sie erstellen gerade einen Beitrag zum Thema '"+t._s(t.parentReference)+"'. Was möchten Sie mitteilen?\n          ")]):i("p",[t._v("\n            Sie eröffnen ein ganz neues Thema. Was möchten Sie mitteilen?\n          ")])])]),i("q-input",{attrs:{type:"text",label:t.$t("contenttree.editor.content_title"),standout:"bg-teal text-white","stack-label":"","input-style":"padding-top:2.5em; padding-bottom:0.6em",counter:"",filled:"",error:"title"in t.errors,"error-message":t.errors.title,maxlength:"60",autofocus:""},model:{value:t.localmodel.title,callback:function(e){t.$set(t.localmodel,"title",e)},expression:"localmodel.title"}}),i("q-input",{attrs:{hint:t.$t("contenttree.editor.content_text_hint"),type:"textarea",counter:"",filled:"","input-style":"padding-top:0.5em",label:"Ihr Beitrag",error:"text"in t.errors,"error-message":t.errors.text,maxlength:t.maxTextLength},on:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.stopPropagation()}},model:{value:t.localmodel.text,callback:function(e){t.$set(t.localmodel,"text",e)},expression:"localmodel.text"}}),i("br"),i("span",{attrs:{hidden:!t.IsManager}},[i("b",[t._v(t._s(t.$t("contenttree.editor.content_type")))]),i("br"),"type"in t.errors?i("div",{staticClass:"bg-red q-pa-sm q-ma-sm"},[t._v(t._s(t.errors.type))]):t._e(),t._v("\n\n        "+t._s(t.$t("contenttree.editor.content_type_hint"))+"\n        "),i("q-option-group",{attrs:{name:"preferred_genre",options:t.contextNodeTypesOptions,dense:"",color:"primary",inline:""},model:{value:t.localmodel.type,callback:function(e){t.$set(t.localmodel,"type",e)},expression:"localmodel.type"}})],1),i("br"),t.isAModification?i("div",[i("b",[t._v("Beitrag löschen")]),t._v("\n        Wenn Sie die folgende Checkbox aktivieren wird dieser Beitrag (und sämtliche angehängten Beiträge) von der Plattform genommen.\n        "),i("q-toggle",{staticClass:"q-ma-none q-mt-md",attrs:{"false-value":!1,"true-value":!0,size:"xl","checked-icon":"mdi-delete-variant","unchecked-icon":"mdi-eye-outline",color:"red",label:t.localmodel.disabled?"Der Beitrag ist im Papierkorb. Möchten Sie ihn wieder herausnehmen?":"Möchten Sie diesen Beitrag in den Papierkorb verschieben?"},model:{value:t.localmodel.disabled,callback:function(e){t.$set(t.localmodel,"disabled",e)},expression:"localmodel.disabled"}})],1):t._e(),t.IsManager&&t.isAModification?i("div",[i("b",[t._v("Beitrag Verschieben")]),t._v("\n        Als Event-Manager können Sie die Beiträge auch verschieben. Möchten Sie das tun?\n        "),t.showParentSelectionBool?t._e():i("q-btn",{attrs:{label:"Elternbeiträge laden"},on:{click:t.showParentSelection}}),t.showParentSelectionBool?i("q-select",{staticStyle:{width:"250px"},attrs:{filled:"","use-input":"","input-debounce":"0",label:"Eltern-Beitrag","display-value":"Beitrag: "+(t.currentParent?"#"+t.currentParent.content.id+" "+t.currentParent.content.title:"*Oberste Ebene*"),options:t.parentOptionsFiltered,"option-value":function(e){return e?e.content.id:null},"option-label":function(t){return(t&&t.content.id==e.localmodel.parent_id?"*** ":"")+"#"+t.content.id+" "+t.content.title},"option-disable":function(e){return!!e&&(e.content.disabled||e.content.deleted)},"map-options":"","emit-value":"",behavior:"menu"},on:{filter:t.filterParentsFn},scopedSlots:t._u([{key:"no-option",fn:function(){return[i("q-item",[i("q-item-section",{staticClass:"text-grey"},[t._v("\n                No results\n              ")])],1)]},proxy:!0}],null,!1,1812372623),model:{value:t.localmodel.parent_id,callback:function(e){t.$set(t.localmodel,"parent_id",e)},expression:"localmodel.parent_id"}}):t._e()],1):t._e()],1),t.isAModification?t._e():i("p",[t._v(" Hinweis: In den Diskussionsforen können Sie pro Tag maximal "+t._s(t.dailyContributionLimits.daylimit)+" Beiträge schreiben. "),t.dailyContributionLimits.current>1?i("span",[t._v("Bis jetzt waren es "+t._s(t.dailyContributionLimits.current)+".")]):t._e()]),i("div",{staticStyle:{float:"right"}},[i("q-btn",{attrs:{flat:"",label:"Abbrechen",dense:"",size:"md",icon:"mdi-close"},on:{click:function(e){return e.stopPropagation(),t.$refs["popup_content_formor"].cancel()}}}),i("q-btn",{attrs:{flat:"",label:t.submitButtonLabel,dense:"",size:"md",icon:"mdi-check"},on:{click:function(e){return e.stopPropagation(),t.$refs["popup_content_formor"].set()}}})],1)])])},o=[],r=(n("99af"),n("4de4"),n("caad"),n("c975"),n("e260"),n("13d5"),n("b64b"),n("d3b7"),n("07ac"),n("2532"),n("ddb0"),n("9523")),a=n.n(r),l=n("ded3"),s=n.n(l),c=n("2f62"),d=n("7c15"),p=n("9651"),u={name:"ContentEditor",inject:["CONTENTTREE","getContentReference","getDailyContributionLimits","markDiscussed"],data:function(){return{localmodel:null,originalmodel:null,error:!1,errors:{},errormsg:"",action:null,btnlabel:"",showParentSelectionBool:!1,parentOptions:null,parentOptionsFiltered:[]}},computed:s()({dailyContributionLimits:function(){var e=this.getDailyContributionLimits();return e.number_of_comments},reviewNeeded:function(){var e,t,n;if(this.IsManager)return!1;if(null===(e=this.originalmodel)||void 0===e||!e.type)return!1;var i=!0;return null!==(t=this.originalmodel)&&void 0!==t&&t.type&&(i=isCommonPropertyByConentType(this.originalmodel.type)),null!==(n=this.localmodel)&&void 0!==n&&n.type&&(i=i||isCommonPropertyByConentType(this.localmodel.type)),i},isAModification:function(){return"edit"===this.action},maxTextLength:function(){return this.get_content_text_max_length({contenttreeID:this.CONTENTTREE.contenttreeID,type:this.localmodel.type})},parentReference:function(){var e;return null!==(e=this.localmodel)&&void 0!==e&&e.parent_id?this.getContentReference(this.localmodel.parent_id):null},submitButtonLabel:function(){return this.reviewNeeded?"Absenden":"Speichern"},contextNodeTypes:function(){if(!("id"in this.localmodel))return[];var e=null,t=null;this.localmodel.parent_id&&(t=this.CONTENTTREE.contenttree.entries[this.localmodel.parent_id].content,e=t.type);var n=this.get_allowed_node_types({contenttreeID:this.CONTENTTREE.contenttreeID,parentType:e}),i=this.get_node_types_with_add_permission({contenttreeID:this.CONTENTTREE.contenttreeID,parentType:e});return console.log(e),n=n.filter((function(e){return i.includes(e)})),this.localmodel.type&&!n.includes(this.localmodel.type)&&(n=[this.localmodel.type]),n},contextNodeTypesOptions:function(){var e=this,t=Object.values(this.contextNodeTypes.reduce((function(t,n,i){return s()(s()({},t),{},a()({},i,{value:n,label:e.$i18n.t("contenttree.types.".concat(n))}))}),[]));return t},currentParent:function(){return this.CONTENTTREE.contenttree.entries[this.localmodel.parent_id]}},Object(c["c"])({IsManager:"assemblystore/IsManager",get_allowed_node_types:"contentstore/get_allowed_node_types",get_node_types_with_add_permission:"contentstore/get_node_types_with_add_permission",get_content_text_max_length:"contentstore/get_content_text_max_length",isCommonPropertyByConentType:"contentstore/isCommonPropertyByConentType"})),methods:s()({initialize:function(e,t){console.log("Initialize popup action "+e),this.original=t,this.action=e;var n={id:null,title:"",disabled:!1,type:"",text:"",parent_id:null};t=s()(s()({},n),t);var i=Object.keys(n);for(var o in t)i.indexOf(o)<0&&delete t[o];this.localmodel=t;var r=this.contextNodeTypes;1!=r.length||this.localmodel.type||(this.localmodel.type=r[0]),this.$refs.popup_content_formor.show()},showParentSelection:function(){var e=this,t=Object.values(this.CONTENTTREE.contenttree.entries);console.log(t),this.parentOptions=t.filter((function(t){var n=!t.path.includes(e.localmodel.id);return n})),this.showParentSelectionBool=!0,this.localmodel.parent_id&&(this.parentOptionsFiltered=[this.currentParent])},filterParentsFn:function(e,t){var n=this;t(""!==e?function(){var t=e.toLowerCase();n.parentOptionsFiltered=n.parentOptions.filter((function(e){var n="".concat(e.content.title," ").concat(e.content.text,"  #").concat(e.content.id,"  @").concat(e.creator.FN);return n.toLowerCase().indexOf(t)>-1}))}:function(){n.parentOptionsFiltered=n.parentOptions})},validate:function(){var e=!1;return this.errors={},this.localmodel["type"]&&this.contextNodeTypes.includes(this.localmodel.type)||(this.errors["type"]="Sie müssen ein Inhaltstyp angeben.",e=!0),this.localmodel["title"]||(this.errors["title"]="Bitte fügen Sie einen Titel für diesen Beitrag ein.",e=!0),this.localmodel["text"]?this.localmodel.text.length>this.maxTextLength&&(this.errors["text"]="Den Text den Sie geschrieben haben ist zu lang. Er darf maximal ".concat(this.maxTextLength," Zeichen lang sein."),e=!0):(this.errors.text="Bitte fügen Sie einen Text für diesen Beitrag ein.",e=!0),!e},getTopicID:function(){var e=this.isAModification?this.localmodel.id:this.localmodel.parent_id;if(e){var t,n=null===(t=this.CONTENTTREE.contenttree.entries[e])||void 0===t?void 0:t.path;if(n.length)return n[0]}},saveContent:function(){var e=this;console.log("Save content"),console.assert(this.CONTENTTREE.contenttreeID);var t=p["b"].assemblyIdentifier;console.assert(t);var n=this.getTopicID();n&&this.markDiscussed(this.CONTENTTREE.contenttree.entries[n]);var i=null;i=this.reviewNeeded?d["a"].proposeContent:d["a"].saveContent,i(t,this.CONTENTTREE.contenttreeID,this.localmodel).then((function(t){if(console.log(t.data),console.log("Model saved"),t.data.OK){console.log("data received");var n="proposal"in t.data;"content"in t.data&&(e.update_content({contentTuple:t.data.content}),console.log("SEND TO VUEX",t.data.content),e.$store.dispatch("assemblystore/incrementAssemblyActivityCounter",{counterName:"number_of_comments_today"}),e.isAModification||e.reviewNeeded||setTimeout((function(){console.log("raise Zoomer CONTENT"),e.$emit("expand-node",t.data.content)}),75)),e.$q.notify({type:"nFabrikInfo",message:n?"Der Antrag wurde eingereicht.":e.isAModification?"Die Änderungen wurden gespeichert.":"Der Beitrag wurde gespeichert."})}else e.$q.notify({type:"nFabrikError",message:"Das Formular konnte nicht verarbeitet werden. Bitte informieren Sie die Veranstalter."})})).catch((function(e){console.warn(e)}))}},Object(c["b"])({update_discussed:"contentstore/update_discussed",add_or_update_contenttree:"contentstore/add_or_update_contenttree",update_content:"contentstore/update_content"}))},m=u,h=n("2877"),f=n("42a1"),_=n("9c40"),g=n("27f9"),b=n("0016"),v=n("9f0a"),y=n("9564"),T=n("ddd8"),x=n("66e5"),E=n("4074"),C=n("eebe"),w=n.n(C),N=Object(h["a"])(m,i,o,!1,null,null,null);t["default"]=N.exports;w()(N,"components",{QPopupEdit:f["a"],QBtn:_["a"],QInput:g["a"],QIcon:b["a"],QOptionGroup:v["a"],QToggle:y["a"],QSelect:T["a"],QItem:x["a"],QItemSection:E["a"]})}}]);