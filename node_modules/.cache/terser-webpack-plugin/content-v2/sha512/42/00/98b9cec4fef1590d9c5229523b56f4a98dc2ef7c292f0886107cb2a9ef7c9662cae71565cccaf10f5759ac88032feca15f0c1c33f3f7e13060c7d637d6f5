{"code":"\"use strict\";{const e=django.jQuery;function showAdminPopup(e,t,o){const n=e.id.replace(t,\"\");let s=e.href;o&&(-1===s.indexOf(\"?\")?s+=\"?_popup=1\":s+=\"&_popup=1\");const d=window.open(s,n,\"height=500,width=800,resizable=yes,scrollbars=yes\");return d.focus(),!1}function showRelatedObjectLookupPopup(e){return showAdminPopup(e,/^lookup_/,!0)}function dismissRelatedLookupPopup(e,t){const o=e.name,n=document.getElementById(o);n.classList.contains(\"vManyToManyRawIdAdminField\")&&n.value?n.value+=\",\"+t:document.getElementById(o).value=t,e.close()}function showRelatedObjectPopup(e){return showAdminPopup(e,/^(change|add|delete)_/,!1)}function updateRelatedObjectLinks(t){const o=e(t),n=o.nextAll(\".view-related, .change-related, .delete-related\");if(!n.length)return;const s=o.val();s?n.each((function(){const t=e(this);t.attr(\"href\",t.attr(\"data-href-template\").replace(\"__fk__\",s))})):n.removeAttr(\"href\")}function dismissAddRelatedObjectPopup(t,o,n){const s=t.name,d=document.getElementById(s);if(d){const t=d.nodeName.toUpperCase();\"SELECT\"===t?d.options[d.options.length]=new Option(n,o,!0,!0):\"INPUT\"===t&&(d.classList.contains(\"vManyToManyRawIdAdminField\")&&d.value?d.value+=\",\"+o:d.value=o),e(d).trigger(\"change\")}else{const e=s+\"_to\",t=new Option(n,o);SelectBox.add_to_cache(e,t),SelectBox.redisplay(e)}t.close()}function dismissChangeRelatedObjectPopup(t,o,n,s){const d=t.name.replace(/^edit_/,\"\"),i=interpolate(\"#%s, #%s_from, #%s_to\",[d,d,d]),a=e(i);a.find(\"option\").each((function(){this.value===o&&(this.textContent=n,this.value=s)})),a.next().find(\".select2-selection__rendered\").each((function(){this.lastChild.textContent=n,this.title=n})),t.close()}function dismissDeleteRelatedObjectPopup(t,o){const n=t.name.replace(/^delete_/,\"\"),s=interpolate(\"#%s, #%s_from, #%s_to\",[n,n,n]),d=e(s);d.find(\"option\").each((function(){this.value===o&&e(this).remove()})).trigger(\"change\"),t.close()}window.showRelatedObjectLookupPopup=showRelatedObjectLookupPopup,window.dismissRelatedLookupPopup=dismissRelatedLookupPopup,window.showRelatedObjectPopup=showRelatedObjectPopup,window.updateRelatedObjectLinks=updateRelatedObjectLinks,window.dismissAddRelatedObjectPopup=dismissAddRelatedObjectPopup,window.dismissChangeRelatedObjectPopup=dismissChangeRelatedObjectPopup,window.dismissDeleteRelatedObjectPopup=dismissDeleteRelatedObjectPopup,window.showAddAnotherPopup=showRelatedObjectPopup,window.dismissAddAnotherPopup=dismissAddRelatedObjectPopup,e(document).ready((function(){e(\"a[data-popup-opener]\").on(\"click\",(function(t){t.preventDefault(),opener.dismissRelatedLookupPopup(window,e(this).data(\"popup-opener\"))})),e(\"body\").on(\"click\",\".related-widget-wrapper-link\",(function(t){if(t.preventDefault(),this.href){const t=e.Event(\"django:show-related\",{href:this.href});e(this).trigger(t),t.isDefaultPrevented()||showRelatedObjectPopup(this)}})),e(\"body\").on(\"change\",\".related-widget-wrapper select\",(function(t){const o=e.Event(\"django:update-related\");e(this).trigger(o),o.isDefaultPrevented()||updateRelatedObjectLinks(this)})),e(\".related-widget-wrapper select\").trigger(\"change\"),e(\"body\").on(\"click\",\".related-lookup\",(function(t){t.preventDefault();const o=e.Event(\"django:lookup-related\");e(this).trigger(o),o.isDefaultPrevented()||showRelatedObjectLookupPopup(this)}))}))}","name":"fabrikauth/admin/js/admin/RelatedObjectLookups.js","input":"/*global SelectBox, interpolate*/\n// Handles related-objects functionality: lookup link for raw_id_fields\n// and Add Another links.\n'use strict';\n{\n    const $ = django.jQuery;\n\n    function showAdminPopup(triggeringLink, name_regexp, add_popup) {\n        const name = triggeringLink.id.replace(name_regexp, '');\n        let href = triggeringLink.href;\n        if (add_popup) {\n            if (href.indexOf('?') === -1) {\n                href += '?_popup=1';\n            } else {\n                href += '&_popup=1';\n            }\n        }\n        const win = window.open(href, name, 'height=500,width=800,resizable=yes,scrollbars=yes');\n        win.focus();\n        return false;\n    }\n\n    function showRelatedObjectLookupPopup(triggeringLink) {\n        return showAdminPopup(triggeringLink, /^lookup_/, true);\n    }\n\n    function dismissRelatedLookupPopup(win, chosenId) {\n        const name = win.name;\n        const elem = document.getElementById(name);\n        if (elem.classList.contains('vManyToManyRawIdAdminField') && elem.value) {\n            elem.value += ',' + chosenId;\n        } else {\n            document.getElementById(name).value = chosenId;\n        }\n        win.close();\n    }\n\n    function showRelatedObjectPopup(triggeringLink) {\n        return showAdminPopup(triggeringLink, /^(change|add|delete)_/, false);\n    }\n\n    function updateRelatedObjectLinks(triggeringLink) {\n        const $this = $(triggeringLink);\n        const siblings = $this.nextAll('.view-related, .change-related, .delete-related');\n        if (!siblings.length) {\n            return;\n        }\n        const value = $this.val();\n        if (value) {\n            siblings.each(function() {\n                const elm = $(this);\n                elm.attr('href', elm.attr('data-href-template').replace('__fk__', value));\n            });\n        } else {\n            siblings.removeAttr('href');\n        }\n    }\n\n    function dismissAddRelatedObjectPopup(win, newId, newRepr) {\n        const name = win.name;\n        const elem = document.getElementById(name);\n        if (elem) {\n            const elemName = elem.nodeName.toUpperCase();\n            if (elemName === 'SELECT') {\n                elem.options[elem.options.length] = new Option(newRepr, newId, true, true);\n            } else if (elemName === 'INPUT') {\n                if (elem.classList.contains('vManyToManyRawIdAdminField') && elem.value) {\n                    elem.value += ',' + newId;\n                } else {\n                    elem.value = newId;\n                }\n            }\n            // Trigger a change event to update related links if required.\n            $(elem).trigger('change');\n        } else {\n            const toId = name + \"_to\";\n            const o = new Option(newRepr, newId);\n            SelectBox.add_to_cache(toId, o);\n            SelectBox.redisplay(toId);\n        }\n        win.close();\n    }\n\n    function dismissChangeRelatedObjectPopup(win, objId, newRepr, newId) {\n        const id = win.name.replace(/^edit_/, '');\n        const selectsSelector = interpolate('#%s, #%s_from, #%s_to', [id, id, id]);\n        const selects = $(selectsSelector);\n        selects.find('option').each(function() {\n            if (this.value === objId) {\n                this.textContent = newRepr;\n                this.value = newId;\n            }\n        });\n        selects.next().find('.select2-selection__rendered').each(function() {\n            // The element can have a clear button as a child.\n            // Use the lastChild to modify only the displayed value.\n            this.lastChild.textContent = newRepr;\n            this.title = newRepr;\n        });\n        win.close();\n    }\n\n    function dismissDeleteRelatedObjectPopup(win, objId) {\n        const id = win.name.replace(/^delete_/, '');\n        const selectsSelector = interpolate('#%s, #%s_from, #%s_to', [id, id, id]);\n        const selects = $(selectsSelector);\n        selects.find('option').each(function() {\n            if (this.value === objId) {\n                $(this).remove();\n            }\n        }).trigger('change');\n        win.close();\n    }\n\n    window.showRelatedObjectLookupPopup = showRelatedObjectLookupPopup;\n    window.dismissRelatedLookupPopup = dismissRelatedLookupPopup;\n    window.showRelatedObjectPopup = showRelatedObjectPopup;\n    window.updateRelatedObjectLinks = updateRelatedObjectLinks;\n    window.dismissAddRelatedObjectPopup = dismissAddRelatedObjectPopup;\n    window.dismissChangeRelatedObjectPopup = dismissChangeRelatedObjectPopup;\n    window.dismissDeleteRelatedObjectPopup = dismissDeleteRelatedObjectPopup;\n\n    // Kept for backward compatibility\n    window.showAddAnotherPopup = showRelatedObjectPopup;\n    window.dismissAddAnotherPopup = dismissAddRelatedObjectPopup;\n\n    $(document).ready(function() {\n        $(\"a[data-popup-opener]\").on('click', function(event) {\n            event.preventDefault();\n            opener.dismissRelatedLookupPopup(window, $(this).data(\"popup-opener\"));\n        });\n        $('body').on('click', '.related-widget-wrapper-link', function(e) {\n            e.preventDefault();\n            if (this.href) {\n                const event = $.Event('django:show-related', {href: this.href});\n                $(this).trigger(event);\n                if (!event.isDefaultPrevented()) {\n                    showRelatedObjectPopup(this);\n                }\n            }\n        });\n        $('body').on('change', '.related-widget-wrapper select', function(e) {\n            const event = $.Event('django:update-related');\n            $(this).trigger(event);\n            if (!event.isDefaultPrevented()) {\n                updateRelatedObjectLinks(this);\n            }\n        });\n        $('.related-widget-wrapper select').trigger('change');\n        $('body').on('click', '.related-lookup', function(e) {\n            e.preventDefault();\n            const event = $.Event('django:lookup-related');\n            $(this).trigger(event);\n            if (!event.isDefaultPrevented()) {\n                showRelatedObjectLookupPopup(this);\n            }\n        });\n    });\n}\n","inputSourceMap":null}