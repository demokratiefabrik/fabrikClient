{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[17],{\"5b45\":function(e,t,n){\"use strict\";n.r(t);var i=function(){var e=this,t=this,n=t.$createElement,i=t._self._c||n;return i(\"q-popup-edit\",{ref:\"popup_content_formor\",attrs:{cover:!0,\"max-height\":\"100%\",anchor:\"center middle\",self:\"center middle\",persistent:\"\",validate:t.validate},on:{save:t.saveContent},model:{value:t.localmodel,callback:function(e){t.localmodel=e},expression:\"localmodel\"}},[t.CONTENTTREE.limitForAddingCommentsReached&&!t.isAModification?i(\"div\",{staticClass:\"q-mb-md q-ml-md text-notification\"},[t._v(\"\\n\\n    Sie haben heute schon \"+t._s(t.dailyContributionLimits.current)+\" Kommentare geschrieben. Damit haben Sie die Tageslimite erreicht.\\n    Ab morgen früh können Sie wieder neue Kommentare verfassen.\\n\\n    \"),i(\"q-btn\",{attrs:{flat:\"\",label:\"Abbrechen\",dense:\"\",size:\"md\",icon:\"mdi-close\"},on:{click:function(e){return e.stopPropagation(),t.$refs[\"popup_content_formor\"].cancel()}}})],1):t._e(),!t.$loaded(t.localmodel)||t.CONTENTTREE.limitForAddingCommentsReached&&!t.isAModification?t._e():i(\"div\",{staticClass:\"q-pa-md\"},[i(\"div\",{staticStyle:{float:\"right\"}},[i(\"q-btn\",{attrs:{flat:\"\",label:\"Abbrechen\",dense:\"\",size:\"md\",icon:\"mdi-close\"},on:{click:function(e){return e.stopPropagation(),t.$refs[\"popup_content_formor\"].cancel()}}}),i(\"q-btn\",{attrs:{flat:\"\",label:t.submitButtonLabel,dense:\"\",size:\"md\",icon:\"mdi-check\"},on:{click:function(e){return e.stopPropagation(),t.$refs[\"popup_content_formor\"].set()}}})],1),i(\"div\",{staticClass:\"full-width q-gutter-y-md column\",staticStyle:{\"max-width\":\"600px\"}},[t.isAModification?i(\"div\",[t.reviewNeeded?i(\"p\",[t._v(\" Sie können einen Änderungsvorschlag einreichen. Andere zufällig ausgewählte TeilnehmerInnen werden danach darüber befinden.\")]):t._e(),t.reviewNeeded?t._e():i(\"p\",[t._v(\" Sie können diesen Inhalt direkt bearbeiten oder löschen.\")])]):t._e(),t.isAModification?t._e():i(\"div\",[t.reviewNeeded?i(\"p\",[t._v(\" Sie können hier einen neuen Beitrag vorschlagen. Andere zufällig ausgewählte TeilnehmerInnen werden danach darüber befinden.\")]):t._e(),t.reviewNeeded?t._e():i(\"div\",[t.parentReference?i(\"p\",[t._v(\"\\n            Sie erstellen gerade einen Beitrag zum Thema '\"+t._s(t.parentReference)+\"'. Was möchten Sie mitteilen?\\n          \")]):i(\"p\",[t._v(\"\\n            Sie eröffnen ein ganz neues Thema. Was möchten Sie mitteilen?\\n          \")])])]),i(\"q-input\",{attrs:{type:\"text\",label:t.$t(\"contenttree.editor.content_title\"),standout:\"bg-teal text-white\",\"stack-label\":\"\",\"input-style\":\"padding-top:2.5em; padding-bottom:0.6em\",counter:\"\",filled:\"\",error:\"title\"in t.errors,\"error-message\":t.errors.title,maxlength:\"60\",autofocus:\"\"},model:{value:t.localmodel.title,callback:function(e){t.$set(t.localmodel,\"title\",e)},expression:\"localmodel.title\"}}),i(\"q-input\",{attrs:{hint:t.$t(\"contenttree.editor.content_text_hint\"),type:\"textarea\",counter:\"\",filled:\"\",\"input-style\":\"padding-top:0.5em\",label:\"Ihr Beitrag\",error:\"text\"in t.errors,\"error-message\":t.errors.text,maxlength:t.maxTextLength},on:{keyup:function(e){if(!e.type.indexOf(\"key\")&&t._k(e.keyCode,\"enter\",13,e.key,\"Enter\"))return null;e.stopPropagation()}},model:{value:t.localmodel.text,callback:function(e){t.$set(t.localmodel,\"text\",e)},expression:\"localmodel.text\"}}),i(\"br\"),i(\"span\",{attrs:{hidden:!t.IsManager}},[i(\"b\",[t._v(t._s(t.$t(\"contenttree.editor.content_type\")))]),i(\"br\"),\"type\"in t.errors?i(\"div\",{staticClass:\"bg-red q-pa-sm q-ma-sm\"},[t._v(t._s(t.errors.type))]):t._e(),t._v(\"\\n\\n        \"+t._s(t.$t(\"contenttree.editor.content_type_hint\"))+\"\\n        \"),i(\"q-option-group\",{attrs:{name:\"preferred_genre\",options:t.contextNodeTypesOptions,dense:\"\",color:\"primary\",inline:\"\"},model:{value:t.localmodel.type,callback:function(e){t.$set(t.localmodel,\"type\",e)},expression:\"localmodel.type\"}})],1),i(\"br\"),t.isAModification?i(\"div\",[i(\"b\",[t._v(\"Beitrag löschen\")]),t._v(\"\\n        Wenn Sie die folgende Checkbox aktivieren wird dieser Beitrag (und sämtliche angehängten Beiträge) von der Plattform genommen.\\n        \"),i(\"q-toggle\",{staticClass:\"q-ma-none q-mt-md\",attrs:{\"false-value\":!1,\"true-value\":!0,size:\"xl\",\"checked-icon\":\"mdi-delete-variant\",\"unchecked-icon\":\"mdi-eye-outline\",color:\"red\",label:t.localmodel.disabled?\"Der Beitrag ist im Papierkorb. Möchten Sie ihn wieder herausnehmen?\":\"Möchten Sie diesen Beitrag in den Papierkorb verschieben?\"},model:{value:t.localmodel.disabled,callback:function(e){t.$set(t.localmodel,\"disabled\",e)},expression:\"localmodel.disabled\"}})],1):t._e(),t.IsManager&&t.isAModification?i(\"div\",[i(\"b\",[t._v(\"Beitrag Verschieben\")]),t._v(\"\\n        Als Event-Manager können Sie die Beiträge auch verschieben. Möchten Sie das tun?\\n        \"),t.showParentSelectionBool?t._e():i(\"q-btn\",{attrs:{label:\"Elternbeiträge laden\"},on:{click:t.showParentSelection}}),t.showParentSelectionBool?i(\"q-select\",{staticStyle:{width:\"250px\"},attrs:{filled:\"\",\"use-input\":\"\",\"input-debounce\":\"0\",label:\"Eltern-Beitrag\",\"display-value\":\"Beitrag: \"+(t.currentParent?\"#\"+t.currentParent.content.id+\" \"+t.currentParent.content.title:\"*Oberste Ebene*\"),options:t.parentOptionsFiltered,\"option-value\":function(e){return e?e.content.id:null},\"option-label\":function(t){return(t&&t.content.id==e.localmodel.parent_id?\"*** \":\"\")+\"#\"+t.content.id+\" \"+t.content.title},\"option-disable\":function(e){return!!e&&(e.content.disabled||e.content.deleted)},\"map-options\":\"\",\"emit-value\":\"\",behavior:\"menu\"},on:{filter:t.filterParentsFn},scopedSlots:t._u([{key:\"no-option\",fn:function(){return[i(\"q-item\",[i(\"q-item-section\",{staticClass:\"text-grey\"},[t._v(\"\\n                No results\\n              \")])],1)]},proxy:!0}],null,!1,1812372623),model:{value:t.localmodel.parent_id,callback:function(e){t.$set(t.localmodel,\"parent_id\",e)},expression:\"localmodel.parent_id\"}}):t._e()],1):t._e()],1),t.isAModification?t._e():i(\"p\",[t._v(\" Hinweis: In den Diskussionsforen können Sie pro Tag maximal \"+t._s(t.dailyContributionLimits.daylimit)+\" Beiträge schreiben. \"),t.dailyContributionLimits.current>1?i(\"span\",[t._v(\"Bis jetzt waren es \"+t._s(t.dailyContributionLimits.current)+\".\")]):t._e()]),i(\"div\",{staticStyle:{float:\"right\"}},[i(\"q-btn\",{attrs:{flat:\"\",label:\"Abbrechen\",dense:\"\",size:\"md\",icon:\"mdi-close\"},on:{click:function(e){return e.stopPropagation(),t.$refs[\"popup_content_formor\"].cancel()}}}),i(\"q-btn\",{attrs:{flat:\"\",label:t.submitButtonLabel,dense:\"\",size:\"md\",icon:\"mdi-check\"},on:{click:function(e){return e.stopPropagation(),t.$refs[\"popup_content_formor\"].set()}}})],1)])])},o=[],r=(n(\"99af\"),n(\"4de4\"),n(\"caad\"),n(\"c975\"),n(\"e260\"),n(\"13d5\"),n(\"b64b\"),n(\"d3b7\"),n(\"07ac\"),n(\"2532\"),n(\"ddb0\"),n(\"9523\")),a=n.n(r),l=n(\"ded3\"),s=n.n(l),c=n(\"2f62\"),d=n(\"7c15\"),p=n(\"9651\"),u={name:\"ContentEditor\",inject:[\"CONTENTTREE\",\"getContentReference\",\"getDailyContributionLimits\",\"markDiscussed\"],data:function(){return{localmodel:null,originalmodel:null,error:!1,errors:{},errormsg:\"\",action:null,btnlabel:\"\",showParentSelectionBool:!1,parentOptions:null,parentOptionsFiltered:[]}},computed:s()({dailyContributionLimits:function(){var e=this.getDailyContributionLimits();return e.number_of_comments},reviewNeeded:function(){var e,t,n;if(this.IsManager)return!1;if(null===(e=this.originalmodel)||void 0===e||!e.type)return!1;var i=!0;return null!==(t=this.originalmodel)&&void 0!==t&&t.type&&(i=isCommonPropertyByConentType(this.originalmodel.type)),null!==(n=this.localmodel)&&void 0!==n&&n.type&&(i=i||isCommonPropertyByConentType(this.localmodel.type)),i},isAModification:function(){return\"edit\"===this.action},maxTextLength:function(){return this.get_content_text_max_length({contenttreeID:this.CONTENTTREE.contenttreeID,type:this.localmodel.type})},parentReference:function(){var e;return null!==(e=this.localmodel)&&void 0!==e&&e.parent_id?this.getContentReference(this.localmodel.parent_id):null},submitButtonLabel:function(){return this.reviewNeeded?\"Absenden\":\"Speichern\"},contextNodeTypes:function(){if(!(\"id\"in this.localmodel))return[];var e=null,t=null;this.localmodel.parent_id&&(t=this.CONTENTTREE.contenttree.entries[this.localmodel.parent_id].content,e=t.type);var n=this.get_allowed_node_types({contenttreeID:this.CONTENTTREE.contenttreeID,parentType:e}),i=this.get_node_types_with_add_permission({contenttreeID:this.CONTENTTREE.contenttreeID,parentType:e});return console.log(e),n=n.filter((function(e){return i.includes(e)})),this.localmodel.type&&!n.includes(this.localmodel.type)&&(n=[this.localmodel.type]),n},contextNodeTypesOptions:function(){var e=this,t=Object.values(this.contextNodeTypes.reduce((function(t,n,i){return s()(s()({},t),{},a()({},i,{value:n,label:e.$i18n.t(\"contenttree.types.\".concat(n))}))}),[]));return t},currentParent:function(){return this.CONTENTTREE.contenttree.entries[this.localmodel.parent_id]}},Object(c[\"c\"])({IsManager:\"assemblystore/IsManager\",get_allowed_node_types:\"contentstore/get_allowed_node_types\",get_node_types_with_add_permission:\"contentstore/get_node_types_with_add_permission\",get_content_text_max_length:\"contentstore/get_content_text_max_length\",isCommonPropertyByConentType:\"contentstore/isCommonPropertyByConentType\"})),methods:s()({initialize:function(e,t){console.log(\"Initialize popup action \"+e),this.original=t,this.action=e;var n={id:null,title:\"\",disabled:!1,type:\"\",text:\"\",parent_id:null};t=s()(s()({},n),t);var i=Object.keys(n);for(var o in t)i.indexOf(o)<0&&delete t[o];this.localmodel=t;var r=this.contextNodeTypes;1!=r.length||this.localmodel.type||(this.localmodel.type=r[0]),this.$refs.popup_content_formor.show()},showParentSelection:function(){var e=this,t=Object.values(this.CONTENTTREE.contenttree.entries);console.log(t),this.parentOptions=t.filter((function(t){var n=!t.path.includes(e.localmodel.id);return n})),this.showParentSelectionBool=!0,this.localmodel.parent_id&&(this.parentOptionsFiltered=[this.currentParent])},filterParentsFn:function(e,t){var n=this;t(\"\"!==e?function(){var t=e.toLowerCase();n.parentOptionsFiltered=n.parentOptions.filter((function(e){var n=\"\".concat(e.content.title,\" \").concat(e.content.text,\"  #\").concat(e.content.id,\"  @\").concat(e.creator.FN);return n.toLowerCase().indexOf(t)>-1}))}:function(){n.parentOptionsFiltered=n.parentOptions})},validate:function(){var e=!1;return this.errors={},this.localmodel[\"type\"]&&this.contextNodeTypes.includes(this.localmodel.type)||(this.errors[\"type\"]=\"Sie müssen ein Inhaltstyp angeben.\",e=!0),this.localmodel[\"title\"]||(this.errors[\"title\"]=\"Bitte fügen Sie einen Titel für diesen Beitrag ein.\",e=!0),this.localmodel[\"text\"]?this.localmodel.text.length>this.maxTextLength&&(this.errors[\"text\"]=\"Den Text den Sie geschrieben haben ist zu lang. Er darf maximal \".concat(this.maxTextLength,\" Zeichen lang sein.\"),e=!0):(this.errors.text=\"Bitte fügen Sie einen Text für diesen Beitrag ein.\",e=!0),!e},getTopicID:function(){var e=this.isAModification?this.localmodel.id:this.localmodel.parent_id;if(e){var t,n=null===(t=this.CONTENTTREE.contenttree.entries[e])||void 0===t?void 0:t.path;if(n.length)return n[0]}},saveContent:function(){var e=this;console.log(\"Save content\"),console.assert(this.CONTENTTREE.contenttreeID);var t=p[\"b\"].assemblyIdentifier;console.assert(t);var n=this.getTopicID();n&&this.markDiscussed(this.CONTENTTREE.contenttree.entries[n]);var i=null;i=this.reviewNeeded?d[\"a\"].proposeContent:d[\"a\"].saveContent,i(t,this.CONTENTTREE.contenttreeID,this.localmodel).then((function(t){if(console.log(t.data),console.log(\"Model saved\"),t.data.OK){console.log(\"data received\");var n=\"proposal\"in t.data;\"content\"in t.data&&(e.update_content({contentTuple:t.data.content}),console.log(\"SEND TO VUEX\",t.data.content),e.$store.dispatch(\"assemblystore/incrementAssemblyActivityCounter\",{counterName:\"number_of_comments_today\"}),e.isAModification||e.reviewNeeded||setTimeout((function(){console.log(\"raise Zoomer CONTENT\"),e.$emit(\"expand-node\",t.data.content)}),75)),e.$q.notify({type:\"nFabrikInfo\",message:n?\"Der Antrag wurde eingereicht.\":e.isAModification?\"Die Änderungen wurden gespeichert.\":\"Der Beitrag wurde gespeichert.\"})}else e.$q.notify({type:\"nFabrikError\",message:\"Das Formular konnte nicht verarbeitet werden. Bitte informieren Sie die Veranstalter.\"})})).catch((function(e){console.warn(e)}))}},Object(c[\"b\"])({update_discussed:\"contentstore/update_discussed\",add_or_update_contenttree:\"contentstore/add_or_update_contenttree\",update_content:\"contentstore/update_content\"}))},m=u,h=n(\"2877\"),f=n(\"42a1\"),_=n(\"9c40\"),g=n(\"27f9\"),b=n(\"0016\"),v=n(\"9f0a\"),y=n(\"9564\"),T=n(\"ddd8\"),x=n(\"66e5\"),E=n(\"4074\"),C=n(\"eebe\"),w=n.n(C),N=Object(h[\"a\"])(m,i,o,!1,null,null,null);t[\"default\"]=N.exports;w()(N,\"components\",{QPopupEdit:f[\"a\"],QBtn:_[\"a\"],QInput:g[\"a\"],QIcon:b[\"a\"],QOptionGroup:v[\"a\"],QToggle:y[\"a\"],QSelect:T[\"a\"],QItem:x[\"a\"],QItemSection:E[\"a\"]})}}]);","name":"js/17.d5a1179e.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[17],{\n\n/***/ \"5b45\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@quasar/app/lib/webpack/loader.auto-import-client.js?kebab!./node_modules/vue-loader/lib??vue-loader-options!./src/pages/ContentTree/components/ContentEditor.vue?vue&type=template&id=ecb7730e&\nvar render = function () {\nvar this$1 = this;\nvar _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('q-popup-edit',{ref:\"popup_content_formor\",attrs:{\"cover\":true,\"max-height\":\"100%\",\"anchor\":\"center middle\",\"self\":\"center middle\",\"persistent\":\"\",\"validate\":_vm.validate},on:{\"save\":_vm.saveContent},model:{value:(_vm.localmodel),callback:function ($$v) {_vm.localmodel=$$v},expression:\"localmodel\"}},[(_vm.CONTENTTREE.limitForAddingCommentsReached && !_vm.isAModification)?_c('div',{staticClass:\"q-mb-md q-ml-md text-notification\"},[_vm._v(\"\\n\\n    Sie haben heute schon \"+_vm._s(_vm.dailyContributionLimits.current)+\" Kommentare geschrieben. Damit haben Sie die Tageslimite erreicht.\\n    Ab morgen früh können Sie wieder neue Kommentare verfassen.\\n\\n    \"),_c('q-btn',{attrs:{\"flat\":\"\",\"label\":\"Abbrechen\",\"dense\":\"\",\"size\":\"md\",\"icon\":\"mdi-close\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.$refs['popup_content_formor'].cancel()}}})],1):_vm._e(),(_vm.$loaded(_vm.localmodel) && (!_vm.CONTENTTREE.limitForAddingCommentsReached ||  _vm.isAModification))?_c('div',{staticClass:\"q-pa-md\"},[_c('div',{staticStyle:{\"float\":\"right\"}},[_c('q-btn',{attrs:{\"flat\":\"\",\"label\":\"Abbrechen\",\"dense\":\"\",\"size\":\"md\",\"icon\":\"mdi-close\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.$refs['popup_content_formor'].cancel()}}}),_c('q-btn',{attrs:{\"flat\":\"\",\"label\":_vm.submitButtonLabel,\"dense\":\"\",\"size\":\"md\",\"icon\":\"mdi-check\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.$refs['popup_content_formor'].set()}}})],1),_c('div',{staticClass:\"full-width q-gutter-y-md column\",staticStyle:{\"max-width\":\"600px\"}},[(_vm.isAModification)?_c('div',[(_vm.reviewNeeded)?_c('p',[_vm._v(\" Sie können einen Änderungsvorschlag einreichen. Andere zufällig ausgewählte TeilnehmerInnen werden danach darüber befinden.\")]):_vm._e(),(!_vm.reviewNeeded)?_c('p',[_vm._v(\" Sie können diesen Inhalt direkt bearbeiten oder löschen.\")]):_vm._e()]):_vm._e(),(!_vm.isAModification)?_c('div',[(_vm.reviewNeeded)?_c('p',[_vm._v(\" Sie können hier einen neuen Beitrag vorschlagen. Andere zufällig ausgewählte TeilnehmerInnen werden danach darüber befinden.\")]):_vm._e(),(!_vm.reviewNeeded)?_c('div',[(_vm.parentReference)?_c('p',[_vm._v(\"\\n            Sie erstellen gerade einen Beitrag zum Thema '\"+_vm._s(_vm.parentReference)+\"'. Was möchten Sie mitteilen?\\n          \")]):_c('p',[_vm._v(\"\\n            Sie eröffnen ein ganz neues Thema. Was möchten Sie mitteilen?\\n          \")])]):_vm._e()]):_vm._e(),_c('q-input',{attrs:{\"type\":\"text\",\"label\":_vm.$t('contenttree.editor.content_title'),\"standout\":\"bg-teal text-white\",\"stack-label\":\"\",\"input-style\":\"padding-top:2.5em; padding-bottom:0.6em\",\"counter\":\"\",\"filled\":\"\",\"error\":'title' in _vm.errors,\"error-message\":_vm.errors.title,\"maxlength\":\"60\",\"autofocus\":\"\"},model:{value:(_vm.localmodel.title),callback:function ($$v) {_vm.$set(_vm.localmodel, \"title\", $$v)},expression:\"localmodel.title\"}}),_c('q-input',{attrs:{\"hint\":_vm.$t('contenttree.editor.content_text_hint'),\"type\":\"textarea\",\"counter\":\"\",\"filled\":\"\",\"input-style\":\"padding-top:0.5em\",\"label\":'Ihr Beitrag',\"error\":'text' in _vm.errors,\"error-message\":_vm.errors.text,\"maxlength\":_vm.maxTextLength},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }$event.stopPropagation();}},model:{value:(_vm.localmodel.text),callback:function ($$v) {_vm.$set(_vm.localmodel, \"text\", $$v)},expression:\"localmodel.text\"}}),_c('br'),_c('span',{attrs:{\"hidden\":!_vm.IsManager}},[_c('b',[_vm._v(_vm._s(_vm.$t('contenttree.editor.content_type')))]),_c('br'),('type' in _vm.errors)?_c('div',{staticClass:\"bg-red q-pa-sm q-ma-sm\"},[_vm._v(_vm._s(_vm.errors.type))]):_vm._e(),_vm._v(\"\\n\\n        \"+_vm._s(_vm.$t('contenttree.editor.content_type_hint'))+\"\\n        \"),_c('q-option-group',{attrs:{\"name\":\"preferred_genre\",\"options\":_vm.contextNodeTypesOptions,\"dense\":\"\",\"color\":\"primary\",\"inline\":\"\"},model:{value:(_vm.localmodel.type),callback:function ($$v) {_vm.$set(_vm.localmodel, \"type\", $$v)},expression:\"localmodel.type\"}})],1),_c('br'),(_vm.isAModification)?_c('div',[_c('b',[_vm._v(\"Beitrag löschen\")]),_vm._v(\"\\n        Wenn Sie die folgende Checkbox aktivieren wird dieser Beitrag (und sämtliche angehängten Beiträge) von der Plattform genommen.\\n        \"),_c('q-toggle',{staticClass:\"q-ma-none q-mt-md\",attrs:{\"false-value\":false,\"true-value\":true,\"size\":\"xl\",\"checked-icon\":\"mdi-delete-variant\",\"unchecked-icon\":\"mdi-eye-outline\",\"color\":\"red\",\"label\":_vm.localmodel.disabled ? 'Der Beitrag ist im Papierkorb. Möchten Sie ihn wieder herausnehmen?' : 'Möchten Sie diesen Beitrag in den Papierkorb verschieben?'},model:{value:(_vm.localmodel.disabled),callback:function ($$v) {_vm.$set(_vm.localmodel, \"disabled\", $$v)},expression:\"localmodel.disabled\"}})],1):_vm._e(),(_vm.IsManager && _vm.isAModification)?_c('div',[_c('b',[_vm._v(\"Beitrag Verschieben\")]),_vm._v(\"\\n        Als Event-Manager können Sie die Beiträge auch verschieben. Möchten Sie das tun?\\n        \"),(!_vm.showParentSelectionBool)?_c('q-btn',{attrs:{\"label\":\"Elternbeiträge laden\"},on:{\"click\":_vm.showParentSelection}}):_vm._e(),(_vm.showParentSelectionBool)?_c('q-select',{staticStyle:{\"width\":\"250px\"},attrs:{\"filled\":\"\",\"use-input\":\"\",\"input-debounce\":\"0\",\"label\":\"Eltern-Beitrag\",\"display-value\":(\"Beitrag: \" + (_vm.currentParent ? (\"#\" + (_vm.currentParent.content.id) + \" \" + (_vm.currentParent.content.title)) : '*Oberste Ebene*')),\"options\":_vm.parentOptionsFiltered,\"option-value\":function (tuple) { return tuple ? tuple.content.id : null; },\"option-label\":function (tuple) { return ((tuple && tuple.content.id==this$1.localmodel.parent_id ? '*** ' : '') + \"#\" + (tuple.content.id) + \" \" + (tuple.content.title)); },\"option-disable\":function (tuple) { return tuple ? tuple.content.disabled || tuple.content.deleted : false; },\"map-options\":\"\",\"emit-value\":\"\",\"behavior\":\"menu\"},on:{\"filter\":_vm.filterParentsFn},scopedSlots:_vm._u([{key:\"no-option\",fn:function(){return [_c('q-item',[_c('q-item-section',{staticClass:\"text-grey\"},[_vm._v(\"\\n                No results\\n              \")])],1)]},proxy:true}],null,false,1812372623),model:{value:(_vm.localmodel.parent_id),callback:function ($$v) {_vm.$set(_vm.localmodel, \"parent_id\", $$v)},expression:\"localmodel.parent_id\"}}):_vm._e()],1):_vm._e()],1),(!_vm.isAModification)?_c('p',[_vm._v(\" Hinweis: In den Diskussionsforen können Sie pro Tag maximal \"+_vm._s(_vm.dailyContributionLimits.daylimit)+\" Beiträge schreiben. \"),(_vm.dailyContributionLimits.current > 1)?_c('span',[_vm._v(\"Bis jetzt waren es \"+_vm._s(_vm.dailyContributionLimits.current)+\".\")]):_vm._e()]):_vm._e(),_c('div',{staticStyle:{\"float\":\"right\"}},[_c('q-btn',{attrs:{\"flat\":\"\",\"label\":\"Abbrechen\",\"dense\":\"\",\"size\":\"md\",\"icon\":\"mdi-close\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.$refs['popup_content_formor'].cancel()}}}),_c('q-btn',{attrs:{\"flat\":\"\",\"label\":_vm.submitButtonLabel,\"dense\":\"\",\"size\":\"md\",\"icon\":\"mdi-check\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.$refs['popup_content_formor'].set()}}})],1)]):_vm._e()])}\nvar staticRenderFns = []\n\n\n// CONCATENATED MODULE: ./src/pages/ContentTree/components/ContentEditor.vue?vue&type=template&id=ecb7730e&\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.concat.js\nvar es_array_concat = __webpack_require__(\"99af\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.filter.js\nvar es_array_filter = __webpack_require__(\"4de4\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.includes.js\nvar es_array_includes = __webpack_require__(\"caad\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.index-of.js\nvar es_array_index_of = __webpack_require__(\"c975\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.iterator.js\nvar es_array_iterator = __webpack_require__(\"e260\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.reduce.js\nvar es_array_reduce = __webpack_require__(\"13d5\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.keys.js\nvar es_object_keys = __webpack_require__(\"b64b\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.to-string.js\nvar es_object_to_string = __webpack_require__(\"d3b7\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.values.js\nvar es_object_values = __webpack_require__(\"07ac\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.includes.js\nvar es_string_includes = __webpack_require__(\"2532\");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.iterator.js\nvar web_dom_collections_iterator = __webpack_require__(\"ddb0\");\n\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/defineProperty.js\nvar defineProperty = __webpack_require__(\"9523\");\nvar defineProperty_default = /*#__PURE__*/__webpack_require__.n(defineProperty);\n\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/objectSpread2.js\nvar objectSpread2 = __webpack_require__(\"ded3\");\nvar objectSpread2_default = /*#__PURE__*/__webpack_require__.n(objectSpread2);\n\n// EXTERNAL MODULE: ./node_modules/vuex/dist/vuex.esm.js\nvar vuex_esm = __webpack_require__(\"2f62\");\n\n// EXTERNAL MODULE: ./src/utils/api.js\nvar api = __webpack_require__(\"7c15\");\n\n// EXTERNAL MODULE: ./src/store/runtime.store.js\nvar runtime_store = __webpack_require__(\"9651\");\n\n// CONCATENATED MODULE: ./node_modules/@quasar/app/lib/webpack/loader.transform-quasar-imports.js!./node_modules/babel-loader/lib??ref--2-0!./node_modules/@quasar/app/lib/webpack/loader.auto-import-client.js?kebab!./node_modules/vue-loader/lib??vue-loader-options!./src/pages/ContentTree/components/ContentEditor.vue?vue&type=script&lang=js&\n\n\n\n\n\n\n\n\n\n\n\n\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n\n/* harmony default export */ var ContentEditorvue_type_script_lang_js_ = ({\n  name: \"ContentEditor\",\n  inject: [\"CONTENTTREE\", \"getContentReference\", \"getDailyContributionLimits\", \"markDiscussed\"],\n  data: function data() {\n    return {\n      localmodel: null,\n      originalmodel: null,\n      error: false,\n      errors: {},\n      errormsg: \"\",\n      action: null,\n      btnlabel: \"\",\n      showParentSelectionBool: false,\n      parentOptions: null,\n      parentOptionsFiltered: []\n    };\n  },\n  computed: objectSpread2_default()({\n    dailyContributionLimits: function dailyContributionLimits() {\n      var limits = this.getDailyContributionLimits();\n      return limits.number_of_comments;\n    },\n\n    /* Get all context types that are allowed at this position.\n    There are a) general contenttree restrictions (See Configuration.CONTENT_TYPES),\n    There are b) parentType restrictions (See Configuration.ONTOLOGY),\n    and there are c) context restrictions (See QTree.filterTypes-Prop)),\n     */\n    reviewNeeded: function reviewNeeded() {\n      var _this$originalmodel, _this$originalmodel2, _this$localmodel;\n\n      // Manager cannot add proposal...\n      if (this.IsManager) {\n        return false;\n      }\n\n      if (!((_this$originalmodel = this.originalmodel) !== null && _this$originalmodel !== void 0 && _this$originalmodel.type)) {\n        return false;\n      } // For Modification: check old a new content type...(if at least one is commont property, return true)\n\n\n      var propertyIsCommon = true;\n\n      if ((_this$originalmodel2 = this.originalmodel) !== null && _this$originalmodel2 !== void 0 && _this$originalmodel2.type) {\n        propertyIsCommon = isCommonPropertyByConentType(this.originalmodel.type);\n      }\n\n      if ((_this$localmodel = this.localmodel) !== null && _this$localmodel !== void 0 && _this$localmodel.type) {\n        propertyIsCommon = propertyIsCommon || isCommonPropertyByConentType(this.localmodel.type);\n      }\n\n      return propertyIsCommon;\n    },\n    isAModification: function isAModification() {\n      return this.action === \"edit\";\n    },\n    maxTextLength: function maxTextLength() {\n      return this.get_content_text_max_length({\n        contenttreeID: this.CONTENTTREE.contenttreeID,\n        type: this.localmodel.type\n      });\n    },\n    parentReference: function parentReference() {\n      var _this$localmodel2;\n\n      if (!((_this$localmodel2 = this.localmodel) !== null && _this$localmodel2 !== void 0 && _this$localmodel2.parent_id)) {\n        return null;\n      }\n\n      return this.getContentReference(this.localmodel.parent_id);\n    },\n    submitButtonLabel: function submitButtonLabel() {\n      if (this.reviewNeeded) {\n        return \"Absenden\";\n      }\n\n      return \"Speichern\";\n    },\n    contextNodeTypes: function contextNodeTypes() {\n      if (!(\"id\" in this.localmodel)) {\n        return [];\n      }\n\n      var parentType = null;\n      var parent = null;\n\n      if (this.localmodel.parent_id) {\n        parent = this.CONTENTTREE.contenttree.entries[this.localmodel.parent_id].content;\n        parentType = parent.type;\n      }\n\n      var context_node_types = this.get_allowed_node_types({\n        contenttreeID: this.CONTENTTREE.contenttreeID,\n        parentType: parentType\n      });\n      var allowedContentTypesToAdd = this.get_node_types_with_add_permission({\n        contenttreeID: this.CONTENTTREE.contenttreeID,\n        parentType: parentType\n      }); // Overlap\n\n      console.log(parentType);\n      context_node_types = context_node_types.filter(function (value) {\n        return allowedContentTypesToAdd.includes(value);\n      });\n\n      if (this.localmodel.type && !context_node_types.includes(this.localmodel.type)) {\n        context_node_types = [this.localmodel.type];\n      } // FILTER THE TYPES, THE USER HAS ADD PERMISSION\n      // if (this.reviewNeeded){\n      //   // Review needed:\n      // }else{\n      //       // TODO: filter ALLOWED_CONTENT_TYPES_TO_ADD\n      // }\n      // CONTEXT\n      // TODO: are there any filtered node types in this context?\n      // context_node_types = context_node_types.filter((v) =>\n      //   this.realFilterTypes.includes(v)\n      // );\n      // console.log(\"context_node_types\", context_node_types);\n\n\n      return context_node_types;\n    },\n    contextNodeTypesOptions: function contextNodeTypesOptions() {\n      var _this = this;\n\n      var options = Object.values(this.contextNodeTypes.reduce(function (obj, cur, i) {\n        return objectSpread2_default()(objectSpread2_default()({}, obj), {}, defineProperty_default()({}, i, {\n          value: cur,\n          label: _this.$i18n.t(\"contenttree.types.\".concat(cur))\n        }));\n      }, []));\n      return options;\n    },\n    currentParent: function currentParent() {\n      return this.CONTENTTREE.contenttree.entries[this.localmodel.parent_id];\n    }\n  }, Object(vuex_esm[\"c\" /* mapGetters */])({\n    IsManager: \"assemblystore/IsManager\",\n    get_allowed_node_types: \"contentstore/get_allowed_node_types\",\n    get_node_types_with_add_permission: \"contentstore/get_node_types_with_add_permission\",\n    get_content_text_max_length: \"contentstore/get_content_text_max_length\",\n    isCommonPropertyByConentType: \"contentstore/isCommonPropertyByConentType\"\n  })),\n  methods: objectSpread2_default()({\n    initialize: function initialize(action, model) {\n      console.log(\"Initialize popup action \" + action);\n      this.original = model;\n      this.action = action;\n      var template = {\n        id: null,\n        title: \"\",\n        disabled: false,\n        type: \"\",\n        text: \"\",\n        parent_id: null\n      }; // take template as default values\n\n      model = objectSpread2_default()(objectSpread2_default()({}, template), model); // remove all keys that are not in the template object\n\n      var keys_to_keep = Object.keys(template);\n\n      for (var k in model) {\n        if (keys_to_keep.indexOf(k) < 0) {\n          delete model[k];\n        }\n      } // store model\n\n\n      this.localmodel = model; // validate / and pre-select type\n\n      var types = this.contextNodeTypes;\n\n      if (types.length == 1 && !this.localmodel.type) {\n        this.localmodel.type = types[0];\n      }\n\n      this.$refs.popup_content_formor.show();\n    },\n    showParentSelection: function showParentSelection() {\n      var _this2 = this;\n\n      var tmpParentOptions = Object.values(this.CONTENTTREE.contenttree.entries);\n      console.log(tmpParentOptions);\n      this.parentOptions = tmpParentOptions.filter(function (v) {\n        var noCyclying = !v.path.includes(_this2.localmodel.id);\n        return noCyclying;\n      }); // console.log(this.parentOptions);\n\n      this.showParentSelectionBool = true;\n\n      if (this.localmodel.parent_id) {\n        this.parentOptionsFiltered = [this.currentParent];\n      }\n    },\n    filterParentsFn: function filterParentsFn(val, update) {\n      var _this3 = this;\n\n      if (val === \"\") {\n        update(function () {\n          _this3.parentOptionsFiltered = _this3.parentOptions;\n        });\n        return;\n      }\n\n      update(function () {\n        var needle = val.toLowerCase();\n        _this3.parentOptionsFiltered = _this3.parentOptions.filter(function (v) {\n          var searchable = \"\".concat(v.content.title, \" \").concat(v.content.text, \"  #\").concat(v.content.id, \"  @\").concat(v.creator.FN);\n          return searchable.toLowerCase().indexOf(needle) > -1;\n        });\n      });\n    },\n    validate: function validate() {\n      // console.log(\"validate...\");\n      var has_error = false;\n      this.errors = {};\n\n      if (!this.localmodel[\"type\"] || !this.contextNodeTypes.includes(this.localmodel.type)) {\n        this.errors[\"type\"] = \"Sie müssen ein Inhaltstyp angeben.\";\n        has_error = true;\n      }\n\n      if (!this.localmodel[\"title\"]) {\n        this.errors[\"title\"] = \"Bitte fügen Sie einen Titel für diesen Beitrag ein.\";\n        has_error = true;\n      }\n\n      if (!this.localmodel[\"text\"]) {\n        this.errors.text = \"Bitte fügen Sie einen Text für diesen Beitrag ein.\";\n        has_error = true;\n      } else if (this.localmodel.text.length > this.maxTextLength) {\n        this.errors[\"text\"] = \"Den Text den Sie geschrieben haben ist zu lang. Er darf maximal \".concat(this.maxTextLength, \" Zeichen lang sein.\");\n        has_error = true;\n      }\n\n      return !has_error;\n    },\n    getTopicID: function getTopicID() {\n      var contentID = this.isAModification ? this.localmodel.id : this.localmodel.parent_id;\n\n      if (contentID) {\n        var _this$CONTENTTREE$con;\n\n        var path = (_this$CONTENTTREE$con = this.CONTENTTREE.contenttree.entries[contentID]) === null || _this$CONTENTTREE$con === void 0 ? void 0 : _this$CONTENTTREE$con.path;\n\n        if (path.length) {\n          return path[0];\n        }\n      }\n    },\n    saveContent: function saveContent() {\n      var _this4 = this;\n\n      // console.log(this.localmodel)\n      console.log(\"Save content\");\n      console.assert(this.CONTENTTREE.contenttreeID);\n      var assemblyIdentifier = runtime_store[\"b\" /* runtimeStore */].assemblyIdentifier;\n      console.assert(assemblyIdentifier); // Set topic as dicussed\n\n      var topicID = this.getTopicID();\n\n      if (topicID) {\n        this.markDiscussed(this.CONTENTTREE.contenttree.entries[topicID]); // this.update_discussed({\n        //   contenttreeID: this.CONTENTTREE.contenttreeID,\n        //   contentID: topicID,\n        // });\n      }\n\n      var submitApiFunction = null;\n\n      if (this.reviewNeeded) {\n        submitApiFunction = api[\"a\" /* default */].proposeContent;\n      } else {\n        submitApiFunction = api[\"a\" /* default */].saveContent;\n      }\n\n      submitApiFunction(assemblyIdentifier, this.CONTENTTREE.contenttreeID, this.localmodel).then(function (response) {\n        console.log(response.data);\n        console.log(\"Model saved\"); // ERROR RESPONSE\n\n        if (response.data.OK) {\n          console.log(\"data received\");\n          var reviewNeeded = (\"proposal\" in response.data); // Update Vuex Store\n\n          if (\"content\" in response.data) {\n            _this4.update_content({\n              contentTuple: response.data.content\n            });\n\n            console.log(\"SEND TO VUEX\", response.data.content);\n\n            _this4.$store.dispatch(\"assemblystore/incrementAssemblyActivityCounter\", {\n              counterName: \"number_of_comments_today\"\n            }); // Zoom to content if needed.\n\n\n            if (!_this4.isAModification && !_this4.reviewNeeded) {\n              // Zoom tO new content\n              setTimeout(function () {\n                console.log(\"raise Zoomer CONTENT\");\n\n                _this4.$emit(\"expand-node\", response.data.content);\n              }, 75);\n            }\n          } // Success Message.\n\n\n          _this4.$q.notify({\n            type: \"nFabrikInfo\",\n            message: reviewNeeded ? \"Der Antrag wurde eingereicht.\" : _this4.isAModification ? \"Die Änderungen wurden gespeichert.\" : \"Der Beitrag wurde gespeichert.\"\n          });\n        } else {\n          // Error Message\n          _this4.$q.notify({\n            type: \"nFabrikError\",\n            message: \"Das Formular konnte nicht verarbeitet werden. Bitte informieren Sie die Veranstalter.\"\n          });\n        }\n      }).catch(function (error) {\n        console.warn(error); // Error Handling is done in Axios Interceptor\n      });\n    }\n  }, Object(vuex_esm[\"b\" /* mapActions */])({\n    update_discussed: \"contentstore/update_discussed\",\n    add_or_update_contenttree: \"contentstore/add_or_update_contenttree\",\n    update_content: \"contentstore/update_content\"\n  }))\n});\n// CONCATENATED MODULE: ./src/pages/ContentTree/components/ContentEditor.vue?vue&type=script&lang=js&\n /* harmony default export */ var components_ContentEditorvue_type_script_lang_js_ = (ContentEditorvue_type_script_lang_js_); \n// EXTERNAL MODULE: ./node_modules/vue-loader/lib/runtime/componentNormalizer.js\nvar componentNormalizer = __webpack_require__(\"2877\");\n\n// EXTERNAL MODULE: ./node_modules/quasar/src/components/popup-edit/QPopupEdit.js + 1 modules\nvar QPopupEdit = __webpack_require__(\"42a1\");\n\n// EXTERNAL MODULE: ./node_modules/quasar/src/components/btn/QBtn.js\nvar QBtn = __webpack_require__(\"9c40\");\n\n// EXTERNAL MODULE: ./node_modules/quasar/src/components/input/QInput.js + 2 modules\nvar QInput = __webpack_require__(\"27f9\");\n\n// EXTERNAL MODULE: ./node_modules/quasar/src/components/icon/QIcon.js\nvar QIcon = __webpack_require__(\"0016\");\n\n// EXTERNAL MODULE: ./node_modules/quasar/src/components/option-group/QOptionGroup.js + 1 modules\nvar QOptionGroup = __webpack_require__(\"9f0a\");\n\n// EXTERNAL MODULE: ./node_modules/quasar/src/components/toggle/QToggle.js\nvar QToggle = __webpack_require__(\"9564\");\n\n// EXTERNAL MODULE: ./node_modules/quasar/src/components/select/QSelect.js + 1 modules\nvar QSelect = __webpack_require__(\"ddd8\");\n\n// EXTERNAL MODULE: ./node_modules/quasar/src/components/item/QItem.js\nvar QItem = __webpack_require__(\"66e5\");\n\n// EXTERNAL MODULE: ./node_modules/quasar/src/components/item/QItemSection.js\nvar QItemSection = __webpack_require__(\"4074\");\n\n// EXTERNAL MODULE: ./node_modules/@quasar/app/lib/webpack/runtime.auto-import.js\nvar runtime_auto_import = __webpack_require__(\"eebe\");\nvar runtime_auto_import_default = /*#__PURE__*/__webpack_require__.n(runtime_auto_import);\n\n// CONCATENATED MODULE: ./src/pages/ContentTree/components/ContentEditor.vue\n\n\n\n\n\n/* normalize component */\n\nvar component = Object(componentNormalizer[\"a\" /* default */])(\n  components_ContentEditorvue_type_script_lang_js_,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* harmony default export */ var ContentEditor = __webpack_exports__[\"default\"] = (component.exports);\n\n\n\n\n\n\n\n\n\n\nruntime_auto_import_default()(component, 'components', {QPopupEdit: QPopupEdit[\"a\" /* default */],QBtn: QBtn[\"a\" /* default */],QInput: QInput[\"a\" /* default */],QIcon: QIcon[\"a\" /* default */],QOptionGroup: QOptionGroup[\"a\" /* default */],QToggle: QToggle[\"a\" /* default */],QSelect: QSelect[\"a\" /* default */],QItem: QItem[\"a\" /* default */],QItemSection: QItemSection[\"a\" /* default */]});\n\n\n/***/ })\n\n}]);","inputSourceMap":null}