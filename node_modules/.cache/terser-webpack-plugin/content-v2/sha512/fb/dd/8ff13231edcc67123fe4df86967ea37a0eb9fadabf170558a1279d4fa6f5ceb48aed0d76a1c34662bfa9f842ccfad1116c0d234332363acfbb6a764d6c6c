{"code":"(function(e){e.fn.aceEditor=function(r){var t=e.extend({showLineNumbers:!0,highlightActiveLine:!0,showPrintMargin:!0,printMarginColumn:72,showFoldWidgets:!1},r),n=e(this),i=e(\"<div/>\").attr(\"id\",n.attr(\"id\")+\"-editor\");n.after(i);var o=ace.edit(i.attr(\"id\"));return o.setOptions(t),o.getSession().setMode(\"ace/mode/django\"),o.getSession().getDocument().setValue(n.hide().val()),o.getSession().on(\"change\",(function(){n.val(o.getSession().getDocument().getValue())})),o},e((function(){var r,t=e(\"#id_language\"),n=e(\"#id_use_markdown\"),i=e(\"#id_html_enabled\"),o=e(\"#id_wrap_columns\"),a=0,c=0,l=e(\"#id_is_marketing\");e(\"#id_useful_queries\").select2().on(\"select2:select\",(function(e){r=e.params.data.id,a=0,h()})).on(\"select2:unselect\",(function(e){r=null,h()}));var s=e(\"#btn-page-previous\");s.click((function(e){e.preventDefault(),a<=0||(a--,h())}));var d=e(\"#btn-page-next\");d.click((function(e){e.preventDefault(),a>c||(a++,h())}));var p=e(\"#btn-page-previous, #btn-page-next\"),u=e(\"#result-count\"),g=e(\"#result-page\");function h(){p.prop(\"disabled\",null==r),g.parent().hide(),u.val(\"\"),null!=r&&(p.prop(\"disabled\",!0),e.post(PREVIEW_URL,{html_enabled:i.prop(\"checked\"),use_markdown:n.prop(\"checked\"),wrap_columns:o.val(),query:r,page:a,language:t.val(),is_marketing:l.prop(\"checked\"),subject:m.getSession().getDocument().getValue(),plain:w.getSession().getDocument().getValue(),html:b.getSession().getDocument().getValue()}).then((function(r){r.error?e(\"#preview-error\").text(r.error):(e(\"#preview-error\").text(\"\"),c=r.query.count,a=r.query.page,u.text(c),g.parent().toggle(!!c),s.prop(\"disabled\",a<=0),d.prop(\"disabled\",a>=c-1),c&&(g.val(a+1).attr(\"max\",c),e(\"#preview-subject-error\").text(r.render.subject.error?r.render.subject.error.msg:\"\"),e(\"#preview-plain .preview-subject > div:last-child, #preview-html .preview-subject\").text(r.render.subject.content),e(\"#preview-plain .preview-header > div:last-child, #preview-html .preview-header\").text(r.render.header),e(\"#preview-plain .preview-content > div:last-child\").text(r.render.plain.content),e(\"#preview-plain-error\").text(r.render.plain.error?r.render.plain.error.msg:\"\"),i.prop(\"checked\")&&(e(\"#preview-html-error\").text(r.render.html.error?r.render.html.error.msg:\"\"),e(\"#preview-html .preview-content\").html(r.render.html.content),n.prop(\"checked\")&&b.getSession().getDocument().setValue(r.html_template))))})))}function v(){var r=i.prop(\"checked\");n.parent().toggle(r),e('a[href=\"#preview-html\"]').parent().toggle(r),r||e('a[href=\"#preview-plain\"]').tab(\"show\"),e(b.container).closest(\".form-group\").toggle(r),b.resize(),b.renderer.updateFull(),r&&b.setReadOnly(n.prop(\"checked\")),h()}g.on(\"change\",(function(){var e=g.val();a=Math.min(c,Math.max(1,e))-1,g.val(e),h()})).on(\"keydown\",(function(e){13===e.keyCode&&e.preventDefault()}));var m=e(\"#id_subject\").aceEditor({minLines:2,maxLines:10});m.getSession().on(\"change\",debounce(h,500)),m.renderer.setScrollMargin(4,4);var w=e(\"#id_plain_body\").aceEditor({minLines:10,maxLines:30});w.getSession().on(\"change\",debounce(h,500)),w.renderer.setScrollMargin(4,4);var b=e(\"#id_html_body\").aceEditor({minLines:10,maxLines:30});b.getSession().on(\"change\",(function(){n.prop(\"checked\")||debounce(h,1e3)})),o.on(\"change\",debounce(h,500)),b.renderer.setScrollMargin(4,4),t.on(\"change\",debounce(h,500)),i.on(\"change\",v),n.on(\"change\",v),v(),h()}))})(jQuery);","name":"fabrikauth/massmailer/template-editor.js","input":"(function ($) {\n  $.fn.aceEditor = function (options) {\n    var settings = $.extend({\n      showLineNumbers: true,\n      highlightActiveLine: true,\n      showPrintMargin: true,\n      printMarginColumn: 72,\n      showFoldWidgets: false,\n    }, options);\n\n    var $this = $(this);\n    var $editor = $('<div/>').attr('id', $this.attr('id') + '-editor');\n    $this.after($editor);\n    var editor = ace.edit($editor.attr('id'));\n    editor.setOptions(settings);\n    editor.getSession().setMode(\"ace/mode/django\");\n    editor.getSession().getDocument().setValue($this.hide().val());\n    editor.getSession().on('change', function () {\n      $this.val(editor.getSession().getDocument().getValue());\n    });\n    return editor;\n  };\n\n  $(function () {\n    var $language = $('#id_language');\n    var $use_markdown = $('#id_use_markdown');\n    var $html_enabled = $('#id_html_enabled');\n    var $wrap_columns = $('#id_wrap_columns');\n    var query_id, page = 0, count = 0;\n    var $is_marketing = $('#id_is_marketing');\n\n    $(\"#id_useful_queries\").select2().on('select2:select', function (e) {\n      query_id = e.params.data.id;\n      page = 0;\n      preview();\n    }).on('select2:unselect', function (e) {\n      query_id = null;\n      preview();\n    });\n\n    var $page_previous = $('#btn-page-previous');\n    $page_previous.click(function (e) {\n      e.preventDefault();\n      if (page <= 0)\n        return;\n      page--;\n      preview();\n    });\n    var $page_next = $('#btn-page-next');\n    $page_next.click(function (e) {\n      e.preventDefault();\n      if (page > count)\n        return;\n      page++;\n      preview();\n    });\n    var $page_buttons = $('#btn-page-previous, #btn-page-next');\n\n    var $result_count = $('#result-count');\n    var $result_page = $('#result-page');\n    $result_page\n      .on('change', function () {\n        var want = $result_page.val();\n        page = Math.min(count, Math.max(1, want)) - 1;\n        $result_page.val(want);\n        preview();\n      })\n      .on('keydown', function (e) {\n        // return submits the non existent form -_-\n        if (e.keyCode === 13) e.preventDefault();\n      });\n\n    function preview() {\n      $page_buttons.prop('disabled', query_id == null);\n      $result_page.parent().hide();\n      $result_count.val('');\n      if (query_id == null)\n        return;\n      $page_buttons.prop('disabled', true);\n      $.post(PREVIEW_URL, {\n        html_enabled: $html_enabled.prop('checked'),\n        use_markdown: $use_markdown.prop('checked'),\n        wrap_columns: $wrap_columns.val(),\n        query: query_id,\n        page: page,\n        language: $language.val(),\n        is_marketing: $is_marketing.prop('checked'),\n        subject: subject_editor.getSession().getDocument().getValue(),\n        plain: plain_editor.getSession().getDocument().getValue(),\n        html: html_editor.getSession().getDocument().getValue(),\n      })\n        .then(function (data) {\n          if (data.error) {\n            $('#preview-error').text(data.error);\n            return;\n          }\n          $('#preview-error').text('');\n          count = data.query.count;\n          page = data.query.page;\n          $result_count.text(count);\n          $result_page.parent().toggle(!!count);\n          $page_previous.prop('disabled', page <= 0);\n          $page_next.prop('disabled', page >= count - 1);\n          if (!count) {\n            return;\n          }\n          $result_page.val(page + 1).attr('max', count);\n          $('#preview-subject-error').text(data.render.subject.error ? data.render.subject.error.msg : '');\n          $('#preview-plain .preview-subject > div:last-child, #preview-html .preview-subject').text(data.render.subject.content);\n          $('#preview-plain .preview-header > div:last-child, #preview-html .preview-header').text(data.render.header);\n          $('#preview-plain .preview-content > div:last-child').text(data.render.plain.content);\n          $('#preview-plain-error').text(data.render.plain.error ? data.render.plain.error.msg : '');\n          if ($html_enabled.prop('checked')) {\n            $('#preview-html-error').text(data.render.html.error ? data.render.html.error.msg : '');\n            $('#preview-html .preview-content').html(data.render.html.content);\n            if ($use_markdown.prop('checked')) {\n              html_editor.getSession().getDocument().setValue(data.html_template);\n            }\n          }\n        });\n    }\n\n    function updateHtmlEnable() {\n      var enable = $html_enabled.prop('checked');\n      $use_markdown.parent().toggle(enable);\n      $('a[href=\"#preview-html\"]').parent().toggle(enable);\n      if (!enable) {\n        $('a[href=\"#preview-plain\"]').tab('show');\n      }\n      $(html_editor.container).closest('.form-group').toggle(enable);\n      html_editor.resize();\n      html_editor.renderer.updateFull();\n      if (enable)\n        html_editor.setReadOnly($use_markdown.prop('checked'));\n      preview();\n    }\n\n    var subject_editor = $('#id_subject').aceEditor({\n      minLines: 2,\n      maxLines: 10,\n    });\n\n    subject_editor.getSession().on('change', debounce(preview, 500));\n    subject_editor.renderer.setScrollMargin(4, 4);\n\n    var plain_editor = $('#id_plain_body').aceEditor({\n      minLines: 10,\n      maxLines: 30,\n    });\n    plain_editor.getSession().on('change', debounce(preview, 500));\n    plain_editor.renderer.setScrollMargin(4, 4);\n\n    var html_editor = $('#id_html_body').aceEditor({\n      minLines: 10,\n      maxLines: 30,\n    });\n    html_editor.getSession().on('change', function () {\n      if (!$use_markdown.prop('checked'))\n        debounce(preview, 1000);\n    });\n    $wrap_columns.on('change', debounce(preview, 500));\n    html_editor.renderer.setScrollMargin(4, 4);\n\n    $language.on('change', debounce(preview, 500));\n\n    $html_enabled.on('change', updateHtmlEnable);\n    $use_markdown.on('change', updateHtmlEnable);\n    updateHtmlEnable();\n    preview();\n  });\n\n}(jQuery));\n","inputSourceMap":null}